<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å„²è“„å‹ä¿éšªæ¨¡æ“¬å™¨</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      background-color: #f4f4f4;
      padding: 20px;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 800px;
      margin: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      word-break: break-word;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    td, th {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    tr:nth-child(odd) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #e0f7fa;
    }
    td:last-child {
      background-color: #fff9c4;
      font-weight: 500;
      color: #333;
    }
    img.logo {
      width: 80px;
      height: auto;
      display: block;
      margin: 0 auto 10px;
      border-radius: 50%;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      font-size: 14px;
      color: #777;
    }
    .highlight-blue {
      color: blue;
      font-weight: bold;
    }
    .highlight-red {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container" id="pdf-content">
    <img class="logo" src="https://i0.wp.com/elock.com.tw/wp-content/uploads/2023/05/%E5%84%B2%E8%93%84%E9%9A%AA%E4%BF%9D%E5%96%AE%E7%9A%843%E7%A8%AE%E6%8C%91%E9%81%B8%E6%96%B9%E6%B3%95.jpg?resize=768%2C768&ssl=1" alt="Logo">
    <h1 class="mb-4 text-center">å„²è“„å‹ä¿éšªæ¨¡æ“¬å™¨</h1>

    <form id="insuranceForm">
      <label>å¹´ç¹³ä¿è²»ï¼ˆå…ƒï¼‰ï¼š<input type="number" id="premium" class="form-control" required></label><br>
      <label>ç¹³è²»å¹´æœŸï¼ˆå¹´ï¼‰ï¼š<input type="number" id="years" class="form-control" required></label><br>
      <label>å¹´åˆ©ç‡ï¼ˆ%ï¼‰ï¼š<input type="number" id="rate" class="form-control" step="any" required></label><br>
      <button class="btn btn-success mt-2" type="submit">é–‹å§‹è©¦ç®—</button>
    </form>

    <div class="mt-3">
      <button class="btn btn-secondary" id="downloadPdfBtn">ä¸‹è¼‰ PDF</button>
    </div>

    <div id="results" class="mt-4"></div>
  </div>

  <footer>
    <p>å¯¦è¸å¤§å­¸ é‡‘ç®¡ä¸€ç”²</p>
    <p>113-2ç¨‹å¼è¨­è¨ˆæœŸæœ«ä½œæ¥­</p>
    <p>é™³ç¥ˆç¿ã€æ—è»’ä½‘ã€è³´æ†²æ¨Ÿã€æäºåŸã€èƒ¡æ™¯ç¿”</p>
    <p>2025 è£½</p>  
  </footer>

  <!-- PDF æ•™å­¸ Modal -->
  <div class="modal fade" id="pdfHelpModal" tabindex="-1" aria-labelledby="pdfHelpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title" id="pdfHelpModalLabel">å¦‚ä½•å„²å­˜ PDFï¼Ÿ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <strong>iOS ä½¿ç”¨è€…ï¼š</strong><br>
          é»æ“Š <span class="highlight-blue">é—œé–‰</span>ï¼Œé»æ“Š <span class="highlight-blue">åˆ†äº«</span>ï¼Œä¸‹æ»‘å³å¯çœ‹åˆ° <span class="highlight-blue">å„²å­˜åˆ°æª”æ¡ˆ</span><br><br>
          <span class="highlight-red">androidã€PCé›»è…¦ è«‹å¿½ç•¥æ­¤è¦–çª—</span><br><br>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">é—œé–‰</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ä¸€é€²å…¥ç¶²é è·³å‡ºæç¤º
    window.addEventListener("DOMContentLoaded", function () {
      alert("ğŸ“Œ è«‹ä½¿ç”¨Google æˆ– Chromeé€²è¡Œç€è¦½ï¼Œç¢ºä¿æ‚¨å…è¨±ä¸‹è¼‰ã€‚");
    });

    let details = [];

    function formatNumber(num) {
      return new Intl.NumberFormat().format(Math.round(num));
    }

    document.getElementById("insuranceForm").addEventListener("submit", function(event) {
      event.preventDefault();

      const premium = parseFloat(document.getElementById("premium").value);
      const years = parseInt(document.getElementById("years").value);
      const rate = parseFloat(document.getElementById("rate").value) / 100;
      const surrenderRate = 0.85;

      if (isNaN(premium) || isNaN(years) || isNaN(rate)) {
        alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ•¸å€¼ï¼");
        return;
      }

      let total = 0;
      details = [];

      for (let i = 1; i <= years; i++) {
        total += premium;
        const interest = total * rate;
        total += interest;
        const surrender = total * surrenderRate;

        details.push({
          year: i,
          premium: formatNumber(premium),
          interest: formatNumber(interest),
          total: formatNumber(total),
          surrender: formatNumber(surrender)
        });
      }

      let html = `<p>é è¨ˆç¸½å„²è“„é‡‘é¡ï¼š<strong>${formatNumber(total)}</strong> å…ƒ</p>`;
      html += `<table>
        <tr><th>å¹´åº¦</th><th>æŠ•å…¥é‡‘é¡</th><th>å¹´åº¦åˆ©æ¯</th><th>ç´¯ç©é‡‘é¡</th><th>è§£ç´„é‡‘é¡ (85%)</th></tr>`;
      for (let row of details) {
        html += `<tr>
          <td>ç¬¬ ${row.year} å¹´</td>
          <td>${row.premium}</td>
          <td>${row.interest}</td>
          <td>${row.total}</td>
          <td>${row.surrender}</td>
        </tr>`;
      }
      html += `</table>`;
      document.getElementById("results").innerHTML = html;
    });

    document.getElementById("downloadPdfBtn").addEventListener("click", async function () {
      const element = document.getElementById("pdf-content");
      const canvas = await html2canvas(element, {
        scale: 2,
        useCORS: true,
        scrollX: 0,
        scrollY: 0,
        windowWidth: element.scrollWidth,
        windowHeight: element.scrollHeight
      });

      const imgData = canvas.toDataURL("image/jpeg", 1.0);
      const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      const imgWidth = pageWidth;
      const imgHeight = canvas.height * imgWidth / canvas.width;

      let heightLeft = imgHeight;
      let position = 0;

      pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;

      while (heightLeft > 0) {
        position -= pageHeight;
        pdf.addPage();
        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }

      pdf.save("å„²è“„å‹ä¿éšªè©¦ç®—å ±å‘Š.pdf");

      // é¡¯ç¤ºæ•™å­¸ Modal
      const modal = new bootstrap.Modal(document.getElementById('pdfHelpModal'));
      modal.show();
    });
  </script>
</body>
</html>
